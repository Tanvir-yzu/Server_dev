<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Edit Profile - {{ user.get_full_name|default:user.email }}</title>
  
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="bg-gray-100 font-sans min-h-screen flex flex-col">

  <!-- Navbar -->
  <nav class="bg-gradient-to-r from-indigo-500 to-purple-600 text-white py-3 sm:py-4">
    <div class="container mx-auto px-4 flex justify-between items-center">
      <a href="{% url 'profile' %}" class="text-lg sm:text-xl font-bold">
        <i class="fas fa-user-circle mr-1 sm:mr-2"></i>
        <span class="hidden sm:inline">Profile</span>
      </a>
      <div class="flex space-x-2 sm:space-x-4 text-sm sm:text-base">
        <a href="{% url 'profile' %}" class="hover:underline flex items-center">
          <i class="fas fa-arrow-left mr-1"></i>
          <span class="hidden sm:inline">Back</span>
        </a>
        <a href="{% url 'logout' %}" class="hover:underline flex items-center">
          <i class="fas fa-sign-out-alt mr-1"></i>
          <span class="hidden sm:inline">Logout</span>
        </a>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="flex-grow">
    <!-- Messages -->
    {% if messages %}
      <div class="container mx-auto px-4 mt-4">
        {% for message in messages %}
          <div class="bg-blue-100 text-blue-800 px-3 sm:px-4 py-2 sm:py-3 rounded mb-2 text-sm sm:text-base">
            <i class="fas fa-info-circle mr-2"></i>{{ message }}
          </div>
        {% endfor %}
      </div>
    {% endif %}

    <!-- Header -->
    <div class="bg-gradient-to-r from-indigo-500 to-purple-600 text-white py-6 sm:py-8 text-center">
      <h1 class="text-2xl sm:text-3xl font-semibold">
        <i class="fas fa-edit mr-2"></i>Edit Profile
      </h1>
      <p class="text-sm mt-2">Update your personal information</p>
    </div>

    <!-- Form -->
    <div class="container mx-auto max-w-3xl px-4 mt-6 sm:mt-8 pb-8">
      <form method="post" enctype="multipart/form-data" class="bg-white rounded-lg shadow-lg p-4 sm:p-6">
        {% csrf_token %}

        <!-- Profile Photo Section -->
        <div class="text-center mb-6 sm:mb-8">
          <h2 class="text-lg sm:text-xl font-semibold mb-3 sm:mb-4">
            <i class="fas fa-camera mr-2"></i>Profile Photo
          </h2>
          {% if profile.photo %}
            <img src="{{ profile.photo.url }}" alt="Profile" class="w-24 h-24 sm:w-28 sm:h-28 rounded-full mx-auto border-4 border-indigo-500 object-cover mb-4" id="photo-preview" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
            <div class="w-24 h-24 sm:w-28 sm:h-28 rounded-full mx-auto bg-indigo-700 text-xl sm:text-2xl font-bold flex items-center justify-center shadow-lg mb-4" style="display: none;" id="photo-fallback">
              {{ user.first_name.0|default:user.email.0|upper }}
            </div>
          {% else %}
            <div class="w-24 h-24 sm:w-28 sm:h-28 rounded-full mx-auto bg-indigo-700 text-xl sm:text-2xl font-bold flex items-center justify-center shadow-lg mb-4" id="photo-fallback">
              {{ user.first_name.0|default:user.email.0|upper }}
            </div>
            <img src="" alt="Profile" class="w-24 h-24 sm:w-28 sm:h-28 rounded-full mx-auto border-4 border-indigo-500 object-cover mb-4" style="display: none;" id="photo-preview">
          {% endif %}
          
          <input 
            type="file" 
            name="photo" 
            id="id_photo"
            accept="image/*"
            class="mt-4 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:border file:border-gray-200 file:rounded file:text-sm file:bg-white file:text-gray-700 hover:file:bg-gray-100"
            onchange="previewPhoto(this)"
          />
          <p class="text-xs sm:text-sm text-gray-500 mt-2">Upload a profile photo (JPG, PNG, max 5MB)</p>
        </div>

        <!-- Personal Information Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6 mb-6">
            <!-- First Name -->
          <div>
            <label for="{{ form.first_name.id_for_label }}" class="block font-medium text-gray-700 mb-1 text-sm sm:text-base">
              <i class="fas fa-user mr-1"></i>First Name
            </label>
            <input 
              type="text" 
              name="{{ form.first_name.name }}" 
              id="{{ form.first_name.id_for_label }}"
              value="{{ form.first_name.value|default:'' }}"
              placeholder="Enter your first name"
              class="w-full px-3 sm:px-4 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-indigo-400 focus:border-transparent text-sm sm:text-base"
            >
            {% for error in form.first_name.errors %}
              <p class="text-red-600 text-sm mt-1"><i class="fas fa-exclamation-circle mr-1"></i>{{ error }}</p>
            {% endfor %}
          </div>
        </div>

        <!-- Email -->
        <div class="mb-4 sm:mb-6">
          <label for="{{ form.email.id_for_label }}" class="block font-medium text-gray-700 mb-1 text-sm sm:text-base">
            <i class="fas fa-envelope mr-1"></i>Email Address
          </label>
          <input 
            type="email" 
            name="{{ form.email.name }}" 
            id="{{ form.email.id_for_label }}"
            value="{{ form.email.value|default:'' }}"
            placeholder="Enter your email address"
            class="w-full px-3 sm:px-4 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-indigo-400 focus:border-transparent text-sm sm:text-base"
            required
          >
          {% for error in form.email.errors %}
            <p class="text-red-600 text-sm mt-1"><i class="fas fa-exclamation-circle mr-1"></i>{{ error }}</p>
          {% endfor %}
        </div>

        <!-- GitHub -->
        <div class="mb-4 sm:mb-6">
          <label for="{{ form.github_link.id_for_label }}" class="block font-medium text-gray-700 mb-1 text-sm sm:text-base">
            <i class="fab fa-github mr-1"></i>GitHub Profile URL
          </label>
          <input 
            type="url" 
            name="{{ form.github_link.name }}" 
            id="{{ form.github_link.id_for_label }}"
            value="{{ form.github_link.value|default:'' }}"
            placeholder="https://github.com/yourusername"
            class="w-full px-3 sm:px-4 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-indigo-400 focus:border-transparent text-sm sm:text-base"
          >
          {% for error in form.github_link.errors %}
            <p class="text-red-600 text-sm mt-1"><i class="fas fa-exclamation-circle mr-1"></i>{{ error }}</p>
          {% endfor %}
          <p class="text-xs sm:text-sm text-gray-500 mt-1">Example: https://github.com/yourusername</p>
        </div>

        <!-- Bio -->
        <div class="mb-6 sm:mb-8">
          <label for="{{ form.bio.id_for_label }}" class="block font-medium text-gray-700 mb-1 text-sm sm:text-base">
            <i class="fas fa-quote-left mr-1"></i>Bio
          </label>
          <textarea 
            name="{{ form.bio.name }}" 
            id="{{ form.bio.id_for_label }}"
            rows="4"
            placeholder="Tell us about yourself..."
            class="w-full px-3 sm:px-4 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-indigo-400 focus:border-transparent text-sm sm:text-base"
            maxlength="500"
            oninput="updateCharCount(this)"
          >{{ form.bio.value|default:'' }}</textarea>
          {% for error in form.bio.errors %}
            <p class="text-red-600 text-sm mt-1"><i class="fas fa-exclamation-circle mr-1"></i>{{ error }}</p>
          {% endfor %}
          <div class="flex justify-between text-xs sm:text-sm text-gray-500 mt-1">
            <span>Tell us about yourself (max 500 characters)</span>
            <span id="char-count">{{ form.bio.value|length|default:0 }} / 500</span>
          </div>
        </div>

        <!-- Submit Buttons -->
        <div class="flex flex-col sm:flex-row justify-center gap-3 sm:gap-4 mt-6">
          <button type="submit" class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold px-4 sm:px-6 py-2 sm:py-3 rounded shadow transition text-sm sm:text-base">
            <i class="fas fa-save mr-2"></i>Save Changes
          </button>
          <a href="{% url 'profile' %}" class="border border-indigo-600 text-indigo-600 hover:bg-indigo-600 hover:text-white font-semibold px-4 sm:px-6 py-2 sm:py-3 rounded text-center transition text-sm sm:text-base">
            <i class="fas fa-times mr-2"></i>Cancel
          </a>
        </div>
      </form>
    </div>
  </main>

  <!-- Footer -->
  <footer class="mt-8 py-4 sm:py-6 bg-gray-900 text-white text-center">
    <div class="container mx-auto px-4">
      <p class="text-xs sm:text-sm">&copy; {% now "Y" %} Server Dev Project. All rights reserved.</p>
    </div>
  </footer>

  <!-- JavaScript -->
  <script>
    // Photo preview function
    function previewPhoto(input) {
      const preview = document.getElementById('photo-preview');
      const fallback = document.getElementById('photo-fallback');
      
      if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
          preview.src = e.target.result;
          preview.style.display = 'block';
          fallback.style.display = 'none';
        };
        reader.readAsDataURL(input.files[0]);
      }
    }

    // Character count function
    function updateCharCount(textarea) {
      const charCount = document.getElementById('char-count');
      const currentLength = textarea.value.length;
      charCount.textContent = `${currentLength} / 500`;
      
      // Change color based on character count
      if (currentLength > 450) {
        charCount.classList.add('text-red-500');
        charCount.classList.remove('text-gray-500');
      } else {
        charCount.classList.add('text-gray-500');
        charCount.classList.remove('text-red-500');
      }
    }

    // Email validation
    document.addEventListener('DOMContentLoaded', function() {
      const emailInput = document.getElementById('{{ form.email.id_for_label }}');
      emailInput.addEventListener('input', function() {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(emailInput.value)) {
          emailInput.setCustomValidity('Please enter a valid email address');
        } else {
          emailInput.setCustomValidity('');
        }
      });
    });
  </script>

</body>
</html>