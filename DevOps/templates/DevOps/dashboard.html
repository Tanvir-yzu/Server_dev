{% extends 'base.html' %}
{% load static %}

{% block title %}DevOps Dashboard{% endblock %}
{% block content %}
<body class="bg-gradient-to-br from-slate-50 via-blue-50 to-purple-50 min-h-screen">
    
    <!-- Animated Background Elements -->
    <div class="fixed inset-0 overflow-hidden pointer-events-none z-0">
        <div class="absolute top-20 left-10 w-96 h-96 bg-blue-200/40 rounded-full blur-3xl animate-pulse"></div>
        <div class="absolute bottom-20 right-10 w-96 h-96 bg-purple-200/40 rounded-full blur-3xl animate-pulse" style="animation-delay: 2s;"></div>
        <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-80 h-80 bg-cyan-200/30 rounded-full blur-3xl" style="animation: float 6s ease-in-out infinite;"></div>
    </div>

    <style>
        @keyframes float {
            0%, 100% { transform: translate(-50%, -50%) translateY(0px); }
            50% { transform: translate(-50%, -50%) translateY(-20px); }
        }
        @keyframes pulse {
            0%, 100% { opacity: 0.4; }
            50% { opacity: 0.6; }
        }
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
        }
        .gradient-text {
            background: linear-gradient(135deg, #2563eb 0%, #9333ea 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
    </style>

    <!-- Main Content -->
    <div class="container mx-auto px-3 sm:px-4 md:px-6 lg:px-8 py-4 sm:py-6 lg:py-10 relative z-10">
        
        <!-- Header Section -->
        <div class="mb-6 sm:mb-8 lg:mb-12">
            <div class="glass-card rounded-3xl shadow-xl p-6 sm:p-8 lg:p-10 border border-white/50">
                <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4 sm:gap-6">
                    <div class="text-center lg:text-left flex-1">
                        <div class="inline-flex items-center justify-center w-12 h-12 sm:w-14 sm:h-14 bg-gradient-to-br from-blue-500 to-purple-600 rounded-2xl mb-4 shadow-lg">
                            <i class="fas fa-rocket text-white text-xl sm:text-2xl"></i>
                        </div>
                        <h1 class="text-2xl sm:text-3xl lg:text-4xl font-bold text-gray-900 mb-2">
                            Welcome back, <span class="gradient-text block sm:inline">{{ user.first_name|default:user.email|truncatechars:15 }}</span>! üëã
                        </h1>
                        <p class="text-base sm:text-lg text-gray-600">Manage your DevOps projects and track deployments</p>
                    </div>
                    <div class="flex flex-col sm:flex-row gap-2 sm:gap-3 w-full lg:w-auto">
                        <a href="{% url 'devops:project_create' %}" 
                           class="inline-flex items-center justify-center px-4 sm:px-6 py-2.5 sm:py-3 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl hover:shadow-blue-500/30 transition-all duration-300 transform hover:-translate-y-1 text-sm sm:text-base">
                            <i class="fas fa-plus mr-2"></i>New Project
                        </a>
                        <a href="{% url 'collaboration:my_invitations' %}" 
                           class="inline-flex items-center justify-center px-4 sm:px-6 py-2.5 sm:py-3 bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl hover:shadow-purple-500/30 transition-all duration-300 transform hover:-translate-y-1 text-sm sm:text-base">
                            <i class="fas fa-envelope mr-2"></i>Invitations
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Statistics Cards -->
        <div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-4 sm:gap-6 mb-8 sm:mb-10">
            <!-- Total Projects Card -->
            <div class="glass-card rounded-2xl shadow-lg hover:shadow-2xl hover:scale-105 transition-all duration-300 p-4 sm:p-6 border border-white/50 group cursor-default">
                <div class="flex items-center justify-between">
                    <div class="min-w-0 flex-1">
                        <p class="text-xs sm:text-sm font-medium text-gray-600 mb-1">Total Projects</p>
                        <p class="text-2xl sm:text-3xl font-bold text-gray-900">{{ total_projects }}</p>
                        <div class="flex flex-col sm:flex-row sm:items-center mt-2 text-xs sm:text-sm gap-1 sm:gap-0">
                            <span class="text-blue-600 font-medium">{{ owned_projects }} owned</span>
                            {% if collaborated_projects > 0 %}
                                <span class="text-gray-400 mx-2 hidden sm:inline">‚Ä¢</span>
                                <span class="text-green-600 font-medium">{{ collaborated_projects }} shared</span>
                            {% endif %}
                        </div>
                    </div>
                    <div class="p-3 sm:p-4 bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl flex-shrink-0 group-hover:scale-110 transition-transform duration-300">
                        <i class="fas fa-project-diagram text-xl sm:text-2xl text-white"></i>
                    </div>
                </div>
            </div>

            <!-- Deployed Projects Card -->
            <div class="glass-card rounded-2xl shadow-lg hover:shadow-2xl hover:scale-105 transition-all duration-300 p-4 sm:p-6 border border-white/50 group cursor-default">
                <div class="flex items-center justify-between">
                    <div class="min-w-0 flex-1">
                        <p class="text-xs sm:text-sm font-medium text-gray-600 mb-1">Deployed</p>
                        <p class="text-2xl sm:text-3xl font-bold text-green-600">{{ deployed_projects }}</p>
                        <div class="flex items-center mt-2">
                            {% if total_projects > 0 %}
                                {% widthratio deployed_projects total_projects 100 as deployment_rate %}
                                <div class="flex items-center text-xs sm:text-sm text-gray-600">
                                    <span class="text-green-600 font-medium">{{ deployment_rate }}%</span>
                                    <span class="ml-1">success rate</span>
                                </div>
                            {% else %}
                                <span class="text-xs sm:text-sm text-gray-500">No projects yet</span>
                            {% endif %}
                        </div>
                    </div>
                    <div class="p-3 sm:p-4 bg-gradient-to-br from-green-500 to-green-600 rounded-2xl flex-shrink-0 group-hover:scale-110 transition-transform duration-300">
                        <i class="fas fa-check-circle text-xl sm:text-2xl text-white"></i>
                    </div>
                </div>
            </div>

            <!-- Pending Projects Card -->
            <div class="glass-card rounded-2xl shadow-lg hover:shadow-2xl hover:scale-105 transition-all duration-300 p-4 sm:p-6 border border-white/50 group cursor-default">
                <div class="flex items-center justify-between">
                    <div class="min-w-0 flex-1">
                        <p class="text-xs sm:text-sm font-medium text-gray-600 mb-1">Pending</p>
                        <p class="text-2xl sm:text-3xl font-bold text-yellow-600">{{ pending_projects }}</p>
                        <div class="mt-2">
                            {% if pending_projects > 0 %}
                                <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
                                    <i class="fas fa-clock mr-1"></i>In Progress
                                </span>
                            {% else %}
                                <span class="text-xs sm:text-sm text-gray-500">All up to date</span>
                            {% endif %}
                        </div>
                    </div>
                    <div class="p-3 sm:p-4 bg-gradient-to-br from-yellow-500 to-yellow-600 rounded-2xl flex-shrink-0 group-hover:scale-110 transition-transform duration-300">
                        <i class="fas fa-clock text-xl sm:text-2xl text-white"></i>
                    </div>
                </div>
            </div>

            <!-- Failed Projects Card -->
            <div class="glass-card rounded-2xl shadow-lg hover:shadow-2xl hover:scale-105 transition-all duration-300 p-4 sm:p-6 border border-white/50 group cursor-default">
                <div class="flex items-center justify-between">
                    <div class="min-w-0 flex-1">
                        <p class="text-xs sm:text-sm font-medium text-gray-600 mb-1">Failed</p>
                        <p class="text-2xl sm:text-3xl font-bold text-red-600">{{ failed_projects }}</p>
                        <div class="mt-2">
                            {% if failed_projects > 0 %}
                                <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">
                                    <i class="fas fa-exclamation-triangle mr-1"></i>Needs Attention
                                </span>
                            {% else %}
                                <span class="text-xs sm:text-sm text-gray-500">No issues</span>
                            {% endif %}
                        </div>
                    </div>
                    <div class="p-3 sm:p-4 bg-gradient-to-br from-red-500 to-red-600 rounded-2xl flex-shrink-0 group-hover:scale-110 transition-transform duration-300">
                        <i class="fas fa-exclamation-triangle text-xl sm:text-2xl text-white"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Actions & Recent Projects Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 sm:gap-8">
            
            <!-- Quick Actions Panel -->
            <div class="lg:col-span-1 order-2 lg:order-1">
                <div class="glass-card rounded-2xl shadow-lg p-4 sm:p-6 border border-white/50">
                    <h3 class="text-lg sm:text-xl font-bold text-gray-900 mb-4 sm:mb-6 flex items-center">
                        <div class="p-2 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl mr-2 sm:mr-3">
                            <i class="fas fa-bolt text-white"></i>
                        </div>
                        Quick Actions
                    </h3>
                    <div class="space-y-3 sm:space-y-4">
                        <a href="{% url 'devops:project_create' %}" 
                           class="flex items-center p-3 sm:p-4 bg-gradient-to-r from-blue-50 to-blue-100 hover:from-blue-100 hover:to-blue-200 rounded-xl transition-all duration-300 group hover:shadow-lg hover:-translate-y-0.5">
                            <div class="p-2 sm:p-3 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl mr-3 sm:mr-4 group-hover:scale-110 group-hover:rotate-6 transition-all duration-300 flex-shrink-0">
                                <i class="fas fa-plus text-white text-sm sm:text-base"></i>
                            </div>
                            <div class="min-w-0">
                                <p class="font-semibold text-gray-900 text-sm sm:text-base group-hover:text-blue-600 transition-colors">Create Project</p>
                                <p class="text-xs sm:text-sm text-gray-600">Start a new DevOps project</p>
                            </div>
                        </a>

                        <a href="{% url 'devops:project_list' %}" 
                           class="flex items-center p-3 sm:p-4 bg-gradient-to-r from-gray-50 to-gray-100 hover:from-gray-100 hover:to-gray-200 rounded-xl transition-all duration-300 group hover:shadow-lg hover:-translate-y-0.5">
                            <div class="p-2 sm:p-3 bg-gradient-to-br from-gray-600 to-gray-700 rounded-xl mr-3 sm:mr-4 group-hover:scale-110 group-hover:rotate-6 transition-all duration-300 flex-shrink-0">
                                <i class="fas fa-list text-white text-sm sm:text-base"></i>
                            </div>
                            <div class="min-w-0">
                                <p class="font-semibold text-gray-900 text-sm sm:text-base group-hover:text-gray-600 transition-colors">View All Projects</p>
                                <p class="text-xs sm:text-sm text-gray-600">Manage your projects</p>
                            </div>
                        </a>

                        <a href="{% url 'collaboration:my_collaborations' %}" 
                           class="flex items-center p-3 sm:p-4 bg-gradient-to-r from-green-50 to-green-100 hover:from-green-100 hover:to-green-200 rounded-xl transition-all duration-300 group hover:shadow-lg hover:-translate-y-0.5">
                            <div class="p-2 sm:p-3 bg-gradient-to-br from-green-500 to-green-600 rounded-xl mr-3 sm:mr-4 group-hover:scale-110 group-hover:rotate-6 transition-all duration-300 flex-shrink-0">
                                <i class="fas fa-users text-white text-sm sm:text-base"></i>
                            </div>
                            <div class="min-w-0">
                                <p class="font-semibold text-gray-900 text-sm sm:text-base group-hover:text-green-600 transition-colors">My Collaborations</p>
                                <p class="text-xs sm:text-sm text-gray-600">Projects you're part of</p>
                            </div>
                        </a>

                        <a href="{% url 'collaboration:my_invitations' %}" 
                           class="flex items-center p-3 sm:p-4 bg-gradient-to-r from-purple-50 to-purple-100 hover:from-purple-100 hover:to-purple-200 rounded-xl transition-all duration-300 group hover:shadow-lg hover:-translate-y-0.5">
                            <div class="p-2 sm:p-3 bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl mr-3 sm:mr-4 group-hover:scale-110 group-hover:rotate-6 transition-all duration-300 flex-shrink-0">
                                <i class="fas fa-envelope text-white text-sm sm:text-base"></i>
                            </div>
                            <div class="min-w-0">
                                <p class="font-semibold text-gray-900 text-sm sm:text-base group-hover:text-purple-600 transition-colors">Pending Invitations</p>
                                <p class="text-xs sm:text-sm text-gray-600">Review collaboration requests</p>
                            </div>
                        </a>
                    </div>
                </div>
            </div>

            <!-- Recent Projects Panel -->
            <div class="lg:col-span-2 order-1 lg:order-2">
                <div class="glass-card rounded-2xl shadow-lg border border-white/50">
                    <div class="p-4 sm:p-6 border-b border-gray-200">
                        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2">
                            <h3 class="text-lg sm:text-xl font-bold text-gray-900 flex items-center">
                                <div class="p-2 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl mr-2 sm:mr-3">
                                    <i class="fas fa-history text-white"></i>
                                </div>
                                Recent Projects
                            </h3>
                            <a href="{% url 'devops:project_list' %}" 
                               class="inline-flex items-center text-blue-600 hover:text-blue-700 font-medium text-sm transition-colors duration-200 self-start sm:self-auto group">
                                View All 
                                <i class="fas fa-arrow-right ml-1 group-hover:translate-x-1 transition-transform"></i>
                            </a>
                        </div>
                    </div>
                    <div class="p-4 sm:p-6">
                        {% if recent_projects %}
                            <div class="space-y-3 sm:space-y-4">
                                {% for project in recent_projects %}
                                    <div class="group p-3 sm:p-4 border border-gray-200 rounded-xl hover:border-blue-400 hover:shadow-lg hover:-translate-y-0.5 transition-all duration-300 bg-white/50">
                                        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
                                            <div class="flex items-center min-w-0 flex-1">
                                                <div class="p-2 sm:p-3 rounded-xl bg-gradient-to-br from-blue-500 to-purple-600 mr-3 sm:mr-4 flex-shrink-0 group-hover:scale-110 transition-transform duration-300">
                                                    <i class="fas fa-code-branch text-white text-sm sm:text-base"></i>
                                                </div>
                                                <div class="min-w-0 flex-1">
                                                    <div class="flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-3 mb-1">
                                                        <a href="{% url 'devops:project_detail' project.pk %}" 
                                                           class="font-semibold text-gray-900 hover:text-blue-600 transition-colors duration-200 truncate text-sm sm:text-base group-hover:underline">
                                                            {{ project.project_name }}
                                                        </a>
                                                        <!-- Role Badge -->
                                                        {% if project.owner == user %}
                                                            <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gradient-to-r from-purple-500 to-purple-600 text-white self-start">
                                                                <i class="fas fa-crown mr-1"></i>Owner
                                                            </span>
                                                        {% else %}
                                                            <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gradient-to-r from-green-500 to-green-600 text-white self-start">
                                                                <i class="fas fa-handshake mr-1"></i>Collaborator
                                                            </span>
                                                        {% endif %}
                                                    </div>
                                                    <p class="text-xs sm:text-sm text-gray-600 truncate">{{ project.domain_name }}</p>
                                                    <p class="text-xs text-gray-500 mt-1">Updated {{ project.created_at|timesince }} ago</p>
                                                </div>
                                            </div>
                                            <div class="flex items-center justify-between sm:justify-end gap-3 sm:gap-4 flex-shrink-0">
                                                <!-- Status Badge -->
                                                <span class="inline-flex items-center px-2 sm:px-3 py-1 rounded-full text-xs font-medium
                                                    {% if project.deployment_status == 'deployed' %}bg-gradient-to-r from-green-400 to-green-500 text-white shadow-md
                                                    {% elif project.deployment_status == 'pending' %}bg-gradient-to-r from-yellow-400 to-yellow-500 text-white shadow-md
                                                    {% elif project.deployment_status == 'failed' %}bg-gradient-to-r from-red-400 to-red-500 text-white shadow-md
                                                    {% else %}bg-gradient-to-r from-gray-400 to-gray-500 text-white shadow-md{% endif %}">
                                                    {% if project.deployment_status == 'deployed' %}
                                                        <i class="fas fa-check-circle mr-1"></i>
                                                    {% elif project.deployment_status == 'pending' %}
                                                        <i class="fas fa-clock mr-1"></i>
                                                    {% elif project.deployment_status == 'failed' %}
                                                        <i class="fas fa-exclamation-triangle mr-1"></i>
                                                    {% endif %}
                                                    <span class="hidden sm:inline">{{ project.get_deployment_status_display }}</span>
                                                    <span class="sm:hidden">
                                                        {% if project.deployment_status == 'deployed' %}‚úì
                                                        {% elif project.deployment_status == 'pending' %}‚è≥
                                                        {% elif project.deployment_status == 'failed' %}‚ö†Ô∏è
                                                        {% else %}‚Äî{% endif %}
                                                    </span>
                                                </span>
                                                
                                                <!-- Action Buttons -->
                                                <div class="flex gap-1 sm:gap-2 sm:opacity-0 sm:group-hover:opacity-100 transition-opacity duration-300">
                                                    <a href="{% url 'devops:server_code' project.pk %}" 
                                                       class="p-1.5 sm:p-2 text-blue-600 hover:bg-blue-100 rounded-lg transition-all duration-200 hover:scale-110"
                                                       title="View Code">
                                                        <i class="fas fa-code text-xs sm:text-sm"></i>
                                                    </a>
                                                    <a href="{% url 'devops:project_detail' project.pk %}" 
                                                       class="p-1.5 sm:p-2 text-gray-600 hover:bg-gray-100 rounded-lg transition-all duration-200 hover:scale-110"
                                                       title="View Details">
                                                        <i class="fas fa-eye text-xs sm:text-sm"></i>
                                                    </a>
                                                    {% if project.owner == user %}
                                                        <a href="{% url 'collaboration:collaborator_list' project_id=project.pk %}" 
                                                           class="p-1.5 sm:p-2 text-purple-600 hover:bg-purple-100 rounded-lg transition-all duration-200 hover:scale-110"
                                                           title="Manage Team">
                                                            <i class="fas fa-users text-xs sm:text-sm"></i>
                                                        </a>
                                                    {% endif %}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                        {% else %}
                            <div class="text-center py-8 sm:py-12">
                                <div class="p-4 sm:p-6 bg-gradient-to-br from-gray-200 to-gray-300 rounded-full w-16 h-16 sm:w-24 sm:h-24 mx-auto mb-4 sm:mb-6 flex items-center justify-center shadow-lg">
                                    <i class="fas fa-folder-open text-2xl sm:text-3xl text-gray-400"></i>
                                </div>
                                <h4 class="text-base sm:text-lg font-semibold text-gray-700 mb-2">No projects yet</h4>
                                <p class="text-sm sm:text-base text-gray-600 mb-4 sm:mb-6 max-w-md mx-auto px-4">
                                    Start your DevOps journey by creating your first project and begin tracking deployments.
                                </p>
                                <a href="{% url 'devops:project_create' %}" 
                                   class="inline-flex items-center px-4 sm:px-6 py-2.5 sm:py-3 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl hover:shadow-blue-500/30 transition-all duration-300 transform hover:-translate-y-1 text-sm sm:text-base">
                                    <i class="fas fa-plus mr-2"></i>Create Your First Project
                                </a>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Enhanced JavaScript for better interactions -->
    <script>
        // Add smooth scroll behavior
        document.documentElement.style.scrollBehavior = 'smooth';

        // Add ripple effect to buttons
        document.querySelectorAll('a, button').forEach(button => {
            button.addEventListener('click', function(e) {
                const ripple = document.createElement('span');
                const rect = this.getBoundingClientRect();
                const size = Math.max(rect.width, rect.height);
                const x = e.clientX - rect.left - size / 2;
                const y = e.clientY - rect.top - size / 2;
                
                ripple.style.cssText = `
                    position: absolute;
                    width: ${size}px;
                    height: ${size}px;
                    left: ${x}px;
                    top: ${y}px;
                    background: rgba(255, 255, 255, 0.4);
                    border-radius: 50%;
                    transform: scale(0);
                    animation: ripple 0.6s ease-out;
                    pointer-events: none;
                `;
                
                this.style.position = 'relative';
                this.style.overflow = 'hidden';
                this.appendChild(ripple);
                
                setTimeout(() => ripple.remove(), 600);
            });
        });

        // Add ripple animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes ripple {
                to {
                    transform: scale(4);
                    opacity: 0;
                }
            }
            @keyframes slideInUp {
                from {
                    opacity: 0;
                    transform: translateY(20px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }
        `;
        document.head.appendChild(style);

        // Add loading states for action buttons
        document.querySelectorAll('a[href*="create"], a[href*="edit"]').forEach(link => {
            link.addEventListener('click', function(e) {
                const icon = this.querySelector('i');
                if (icon && !icon.classList.contains('fa-spin')) {
                    const originalClass = icon.className;
                    icon.className = 'fas fa-spinner fa-spin mr-2';
                    
                    // Reset icon after 3 seconds if page doesn't navigate
                    setTimeout(() => {
                        if (icon) {
                            icon.className = originalClass;
                        }
                    }, 3000);
                }
            });
        });

        // Add stagger animation to cards on page load
        document.addEventListener('DOMContentLoaded', function() {
            const cards = document.querySelectorAll('.glass-card');
            cards.forEach((card, index) => {
                card.style.animation = `slideInUp 0.5s ease-out ${index * 0.1}s backwards`;
            });
        });

        // Add hover effects for cards with touch support
        document.querySelectorAll('.group').forEach(card => {
            card.addEventListener('mouseenter', function() {
                if (window.innerWidth >= 640) { // Only on larger screens
                    this.style.transform = 'translateY(-4px)';
                }
            });
            
            card.addEventListener('mouseleave', function() {
                this.style.transform = 'translateY(0)';
            });

            // Touch support for mobile devices
            card.addEventListener('touchstart', function() {
                this.style.transform = 'translateY(-2px)';
            });

            card.addEventListener('touchend', function() {
                setTimeout(() => {
                    this.style.transform = 'translateY(0)';
                }, 150);
            });
        });

        // Auto-refresh statistics every 30 seconds (only on desktop)
        if (window.innerWidth >= 1024) {
            setInterval(() => {
                // Only refresh if user is active (has interacted recently)
                if (document.hasFocus()) {
                    fetch(window.location.href, {
                        headers: {
                            'X-Requested-With': 'XMLHttpRequest'
                        }
                    }).then(response => {
                        if (response.ok) {
                            // Optionally update statistics without full page reload
                            console.log('Statistics refreshed');
                        }
                    }).catch(err => {
                        console.log('Auto-refresh failed:', err);
                    });
                }
            }, 30000);
        }

        // Handle orientation change
        window.addEventListener('orientationchange', function() {
            setTimeout(() => {
                // Force a reflow to handle any layout issues
                document.body.style.display = 'none';
                document.body.offsetHeight; // Trigger reflow
                document.body.style.display = '';
            }, 100);
        });

        // Optimize for mobile performance
        if ('ontouchstart' in window) {
            // Disable hover effects on touch devices
            document.documentElement.classList.add('touch-device');
            
            // Add CSS for touch devices
            const touchStyle = document.createElement('style');
            touchStyle.textContent = `
                .touch-device .group:hover {
                    transform: none !important;
                }
                .touch-device .opacity-0 {
                    opacity: 1 !important;
                }
            `;
            document.head.appendChild(touchStyle);
        }

        // Add keyboard navigation
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Tab' || e.key === 'Enter' || e.key === ' ') {
                const focusedElement = document.activeElement;
                if (focusedElement) {
                    focusedElement.classList.add('keyboard-focus');
                }
            }
        });

        document.addEventListener('keyup', function(e) {
            document.querySelectorAll('.keyboard-focus').forEach(el => {
                el.classList.remove('keyboard-focus');
            });
        });
    </script>
</body>
{% endblock %}